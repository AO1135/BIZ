<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Indent â€” ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</title>
  <style>
    body { font-family: 'Noto Sans JP', sans-serif; margin: 0; background: #fff; color: #000; }
    header { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #ccc; }
    h1 { font-size: 18px; margin: 0; }
    main { padding: 12px; }
    button, input, select { font-size: 16px; padding: 8px; border: 1px solid #000; border-radius: 6px; box-sizing: border-box; }
    button { background: #000; color: #fff; cursor: pointer; }
    nav { position: fixed; bottom: 0; left: 0; right: 0; display: flex; background: #000; }
    nav button { flex: 1; border: none; border-right: 1px solid #fff; background: #000; color: #fff; padding: 10px; }
    nav button:last-child { border-right: none; }
    .hidden { display: none; }
    .list-item { border: 1px solid #000; padding: 6px; margin-bottom: 6px; border-radius: 6px; display: flex; flex-wrap: wrap; align-items: center; gap: 6px; }
    .list-item input[type="number"] { width: 70px; }
    .copyBtn { background: #fff; color: #000; border: 1px solid #000; }
    .groupTitle { font-weight: bold; border-bottom: 1px solid #000; margin-top: 12px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
</head>
<body>
  <header>
    <h1 id="title">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›</h1>
    <button id="langBtn">æ—¥æœ¬èª / English</button>
  </header>

  <main>
    <!-- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ -->
    <section id="page-password">
      <input id="passwordInput" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" />
      <button id="passwordSubmit">ãƒ­ã‚°ã‚¤ãƒ³</button>
      <p id="passwordError" style="color:red;display:none">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™</p>
    </section>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ -->
    <section id="page-login" class="hidden">
      <input id="userIdInput" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å…¥åŠ›" />
      <button id="loginSubmit">ãƒ­ã‚°ã‚¤ãƒ³</button>
    </section>

    <!-- ãƒã‚§ãƒƒã‚¯å¾…ã¡ãƒªã‚¹ãƒˆ -->
    <section id="page-checklist" class="hidden">
      <h2>ãƒã‚§ãƒƒã‚¯å¾…ã¡ãƒªã‚¹ãƒˆ</h2>

      <!-- ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®š -->
      <div style="margin-bottom:8px;">
        <input id="groupNameInput" placeholder="ã‚°ãƒ«ãƒ¼ãƒ—å (ä¾‹: Aç­)" />
        <button id="setGroupBtn">ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®š</button>
      </div>

      <div style="display:flex;gap:8px;margin-bottom:8px;">
        <input id="productCodeInput" placeholder="7æ¡ã®ã‚³ãƒ¼ãƒ‰" />
        <input id="productQtyInput" type="number" min="1" value="1" />
        <button id="addProductBtn">è¿½åŠ </button>
      </div>

      <div style="margin-bottom:8px;">
        <button id="ocrCaptureBtn">ğŸ“· OCRã§è¿½åŠ </button>
        <input type="file" id="ocrInput" accept="image/*" capture="environment" class="hidden" />
      </div>

      <div id="checklist"></div>
    </section>

    <!-- ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ãƒªã‚¹ãƒˆ -->
    <section id="page-checked" class="hidden">
      <h2>ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ãƒªã‚¹ãƒˆ</h2>
      <div id="checkedList"></div>
    </section>
  </main>

  <nav>
    <button id="navPassword">ğŸ”‘</button>
    <button id="navLogin">ğŸ‘¤</button>
    <button id="navChecklist">ğŸ“‹</button>
    <button id="navChecked">âœ…</button>
  </nav>

  <script>
    const PASSWORD = "letmein123";
    let currentPage = "page-password";
    let currentGroup = "æœªåˆ†é¡";

    const pages = ["page-password","page-login","page-checklist","page-checked"];
    function showPage(id){
      pages.forEach(p=>document.getElementById(p).classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
      currentPage = id;
    }

    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼
    document.getElementById("passwordSubmit").onclick = ()=>{
      const val = document.getElementById("passwordInput").value;
      if(val===PASSWORD){ showPage("page-login"); }
      else {
        const err=document.getElementById("passwordError");
        err.style.display="block"; setTimeout(()=>err.style.display="none",2000);
      }
    };

    // ãƒ­ã‚°ã‚¤ãƒ³
    document.getElementById("loginSubmit").onclick=()=>{
      const id=document.getElementById("userIdInput").value.trim();
      if(!id) return alert("IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      localStorage.setItem("indent:user", id);
      showPage("page-checklist");
    };

    // ãƒŠãƒ“
    document.getElementById("navPassword").onclick=()=>showPage("page-password");
    document.getElementById("navLogin").onclick=()=>showPage("page-login");
    document.getElementById("navChecklist").onclick=()=>showPage("page-checklist");
    document.getElementById("navChecked").onclick=()=>showPage("page-checked");

    // ãƒ‡ãƒ¼ã‚¿ç®¡ç†
    let checklist = JSON.parse(localStorage.getItem("indent:checklist")||"[]");
    let checkedList = JSON.parse(localStorage.getItem("indent:checkedList")||"[]");
    function saveData(){
      localStorage.setItem("indent:checklist", JSON.stringify(checklist));
      localStorage.setItem("indent:checkedList", JSON.stringify(checkedList));
    }

    const checklistEl = document.getElementById("checklist");
    const checkedListEl = document.getElementById("checkedList");

    function renderLists(){
      checklistEl.innerHTML="";

      // ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«ã¾ã¨ã‚ã‚‹
      const groups = {};
      checklist.forEach(item=>{
        if(!groups[item.group]) groups[item.group]=[];
        groups[item.group].push(item);
      });

      Object.keys(groups).forEach(group=>{
        const title=document.createElement("div");
        title.className="groupTitle";
        title.textContent=`ğŸ“¦ ${group}`;
        checklistEl.appendChild(title);

        groups[group].forEach((item,i)=>{
          const div=document.createElement("div");
          div.className="list-item";
          div.innerHTML=`
            <span>${item.code}</span>
            <input type="number" min="1" value="${item.qty}" data-code="${item.code}" class="qtyInput"/>
            <button class="copyBtn" data-code="${item.code}">ã‚³ãƒ”ãƒ¼</button>
            <button class="checkBtn" data-code="${item.code}">âœ”</button>
          `;
          checklistEl.appendChild(div);
        });
      });

      document.querySelectorAll(".qtyInput").forEach(inp=>{
        inp.onchange=(e)=>{
          const code=e.target.dataset.code;
          const target=checklist.find(x=>x.code===code);
          if(target){ target.qty=Number(e.target.value)||1; saveData(); }
        };
      });

      document.querySelectorAll(".copyBtn").forEach(btn=>{
        btn.onclick=()=>{ navigator.clipboard.writeText(btn.dataset.code); alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"); };
      });

      document.querySelectorAll(".checkBtn").forEach(btn=>{
        btn.onclick=()=>{
          const code=btn.dataset.code;
          const idx=checklist.findIndex(x=>x.code===code);
          if(idx>-1){
            checkedList.push(checklist[idx]);
            checklist.splice(idx,1);
            saveData(); renderLists();
          }
        };
      });

      checkedListEl.innerHTML="";
      checkedList.forEach(item=>{
        const div=document.createElement("div");
        div.className="list-item";
        div.textContent=`${item.code} Ã—${item.qty} (${item.group})`;
        checkedListEl.appendChild(div);
      });
    }

    // ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®š
    document.getElementById("setGroupBtn").onclick=()=>{
      const name=document.getElementById("groupNameInput").value.trim();
      if(name) currentGroup=name;
      alert(`ç¾åœ¨ã®ã‚°ãƒ«ãƒ¼ãƒ—: ${currentGroup}`);
    };

    // æ‰‹å…¥åŠ›è¿½åŠ 
    document.getElementById("addProductBtn").onclick=()=>{
      const code=document.getElementById("productCodeInput").value.trim();
      const qty=Number(document.getElementById("productQtyInput").value)||1;
      if(!/^[0-9]{7}$/.test(code)) return alert("7æ¡ã®ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      checklist.push({code,qty,group:currentGroup});
      saveData(); renderLists();
      document.getElementById("productCodeInput").value="";
    };

    // OCRè¿½åŠ 
    const ocrBtn=document.getElementById("ocrCaptureBtn");
    const ocrInput=document.getElementById("ocrInput");
    ocrBtn.onclick=()=>ocrInput.click();

    ocrInput.onchange=async(e)=>{
      const file=e.target.files[0];
      if(!file) return;
      const result = await Tesseract.recognize(file,"eng",{
        tessedit_char_whitelist:"0123456789",
      });
      const found = result.data.text.match(/\d{7}/g);
      if(found && found.length>0){
        found.forEach(num=>{
          checklist.push({code:num,qty:1,group:currentGroup});
        });
        saveData(); renderLists();
        alert(`${found.length}ä»¶ã®ã‚³ãƒ¼ãƒ‰ã‚’${currentGroup}ã«è¿½åŠ ã—ã¾ã—ãŸ`);
      } else {
        alert("7æ¡ã®ã‚³ãƒ¼ãƒ‰ã‚’æ¤œå‡ºã§ãã¾ã›ã‚“ã§ã—ãŸã€‚");
      }
    };

    renderLists();
  </script>
</body>
</html>
