<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Indent â€” ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</title>
<style>
body { font-family: 'Noto Sans JP', sans-serif; margin:0; background:#fff; color:#000; }
header { display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid #ccc; }
h1 { font-size:18px; margin:0; }
main { padding:12px; }
button, input { font-size:16px; padding:6px; border:1px solid #000; border-radius:6px; box-sizing:border-box; }
button { background:#000; color:#fff; cursor:pointer; }
nav { position:fixed; bottom:0; left:0; right:0; display:flex; background:#000; }
nav button { flex:1; border:none; border-right:1px solid #fff; background:#000; color:#fff; padding:10px; }
nav button:last-child { border-right:none; }
.hidden { display:none; }
.list-item { border:1px solid #000; padding:6px; margin-bottom:6px; border-radius:6px; display:flex; flex-wrap:wrap; align-items:center; gap:6px; }
.list-item input[type="number"] { width:70px; }
.list-item input.memoInput { width:100px; }
.copyBtn { background:#fff; color:#000; border:1px solid #000; }
.groupTitle { font-weight:bold; border-bottom:1px solid #000; margin-top:12px; cursor:pointer; }
.modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; }
.modalContent { background:#fff; padding:12px; border-radius:6px; max-width:90%; }
</style>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
</head>
<body>
<header>
<h1 id="title">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›</h1>
<button id="langBtn">æ—¥æœ¬èª / English</button>
</header>

<main>
<section id="page-password">
<input id="passwordInput" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" />
<button id="passwordSubmit">ãƒ­ã‚°ã‚¤ãƒ³</button>
<p id="passwordError" style="color:red;display:none">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™</p>
</section>

<section id="page-login" class="hidden">
<input id="userIdInput" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å…¥åŠ›" />
<button id="loginSubmit">ãƒ­ã‚°ã‚¤ãƒ³</button>
</section>

<section id="page-checklist" class="hidden">
<h2 id="checklistTitle">ãƒã‚§ãƒƒã‚¯å¾…ã¡ãƒªã‚¹ãƒˆ</h2>
<div style="display:flex;gap:8px;margin-bottom:8px;">
<input id="productCodeInput" placeholder="7æ¡ã®ã‚³ãƒ¼ãƒ‰" />
<input id="productQtyInput" type="number" min="1" value="1" />
<button id="addProductBtn">è¿½åŠ </button>
</div>
<div style="margin-bottom:8px;">
<button id="ocrCaptureBtn">ğŸ“· OCRã§è¿½åŠ </button>
<input type="file" id="ocrInput" accept="image/*" capture="environment" class="hidden" />
</div>
<div id="checklist"></div>
<button id="createGroupBtn" style="margin-top:8px;">ï¼‹ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ</button>
</section>

<section id="page-checked" class="hidden">
<h2 id="checkedTitle">ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ãƒªã‚¹ãƒˆ</h2>
<div id="checkedList"></div>
</section>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="groupModal" class="modal hidden">
<div class="modalContent">
<h3 id="groupModalTitle">ã‚°ãƒ«ãƒ¼ãƒ—åã‚’å…¥åŠ›</h3>
<input id="groupNameInput" placeholder="ä¾‹ï¼šæ£šA" style="margin-bottom:6px;"/>
<div id="groupSelectList" style="max-height:200px; overflow:auto; margin-bottom:6px;"></div>
<button id="saveGroupBtn">ä½œæˆ</button>
<button id="cancelGroupBtn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
</div>
</div>

</main>

<nav>
<button id="navPassword">ğŸ”‘</button>
<button id="navLogin">ğŸ‘¤</button>
<button id="navChecklist">ğŸ“‹</button>
<button id="navChecked">âœ…</button>
</nav>

<script>
const PASSWORD = "letmein123";
let currentPage="page-password";
let lang="ja";
let checklist = JSON.parse(localStorage.getItem("indent:checklist")||"[]");
let checkedList = JSON.parse(localStorage.getItem("indent:checkedList")||"[]");

const texts = {
  ja: { password:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›", login:"ãƒ­ã‚°ã‚¤ãƒ³", checklist:"ãƒã‚§ãƒƒã‚¯å¾…ã¡ãƒªã‚¹ãƒˆ", checked:"ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ãƒªã‚¹ãƒˆ", add:"è¿½åŠ ", groupModal:"ã‚°ãƒ«ãƒ¼ãƒ—åã‚’å…¥åŠ›", createGroup:"ï¼‹ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ" },
  en: { password:"Enter Password", login:"Login", checklist:"Checklist", checked:"Checked Items", add:"Add", groupModal:"Enter group name", createGroup:"ï¼‹Create Group" }
};

// --- ãƒšãƒ¼ã‚¸è¡¨ç¤º ---
function showPage(id){ 
  ["page-password","page-login","page-checklist","page-checked"].forEach(p=>document.getElementById(p).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
  currentPage=id;
}
document.getElementById("navPassword").onclick=()=>showPage("page-password");
document.getElementById("navLogin").onclick=()=>showPage("page-login");
document.getElementById("navChecklist").onclick=()=>showPage("page-checklist");
document.getElementById("navChecked").onclick=()=>showPage("page-checked");

// --- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ ---
document.getElementById("passwordSubmit").onclick=()=>{
  const val=document.getElementById("passwordInput").value;
  if(val===PASSWORD) showPage("page-login");
  else { let err=document.getElementById("passwordError"); err.style.display="block"; setTimeout(()=>err.style.display="none",2000);}
};

// --- ãƒ­ã‚°ã‚¤ãƒ³ ---
document.getElementById("loginSubmit").onclick=()=>{
  const id=document.getElementById("userIdInput").value.trim();
  if(!id) return alert(lang==="ja"?"IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„":"Please enter ID");
  localStorage.setItem("indent:user",id);
  showPage("page-checklist");
};

// --- è¨€èªåˆ‡æ›¿ ---
document.getElementById("langBtn").onclick=()=>{
  lang=(lang==="ja"?"en":"ja");
  document.getElementById("title").textContent=texts[lang][currentPage.replace("page-","")];
  document.getElementById("addProductBtn").textContent=texts[lang].add;
  document.getElementById("createGroupBtn").textContent=texts[lang].createGroup;
  document.getElementById("groupModalTitle").textContent=texts[lang].groupModal;
};

// --- ä¿å­˜ ---
function saveData(){
  localStorage.setItem("indent:checklist",JSON.stringify(checklist));
  localStorage.setItem("indent:checkedList",JSON.stringify(checkedList));
}

// --- ãƒªã‚¹ãƒˆæç”» ---
function renderLists(){
  const checklistEl=document.getElementById("checklist");
  const checkedListEl=document.getElementById("checkedList");
  checklistEl.innerHTML="";

  // ã‚°ãƒ«ãƒ¼ãƒ—ãªã—ã®ãƒªã‚¹ãƒˆ
  checklist.forEach((item,i)=>{
    const div=document.createElement("div");
    div.className="list-item";
    div.innerHTML=`<input type="checkbox" data-i="${i}" style="margin-right:6px;"/>
    <span>${item.code}</span>
    <input type="number" min="1" value="${item.qty}" data-i="${i}" class="qtyInput"/>
    <input class="memoInput" type="text" placeholder="ãƒ¡ãƒ¢" value="${item.memo||''}" data-i="${i}"/>
    <button class="copyBtn" data-code="${item.code}">ã‚³ãƒ”ãƒ¼</button>
    <button class="checkBtn" data-i="${i}">âœ”</button>`;
    checklistEl.appendChild(div);
  });

  document.querySelectorAll(".qtyInput").forEach(inp=>{
    inp.onchange=(e)=>{
      const i=e.target.dataset.i;
      checklist[i].qty=Number(e.target.value)||1; saveData();
    };
  });
  document.querySelectorAll(".memoInput").forEach(inp=>{
    inp.oninput=(e)=>{
      const i=e.target.dataset.i;
      checklist[i].memo=e.target.value; saveData();
    };
  });
  document.querySelectorAll(".copyBtn").forEach(btn=>{
    btn.onclick=()=>{ navigator.clipboard.writeText(btn.dataset.code); alert(lang==="ja"?"ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ":"Copied"); };
  });
  document.querySelectorAll(".checkBtn").forEach(btn=>{
    btn.onclick=()=>{
      const i=btn.dataset.i; checkedList.push(checklist[i]); checklist.splice(i,1); saveData(); renderLists();
    };
  });

  checkedListEl.innerHTML="";
  checkedList.forEach(item=>{
    const div=document.createElement("div");
    div.className="list-item";
    div.textContent=`${item.code} Ã—${item.qty} ${item.memo?('('+item.memo+')'):""}`;
    checkedListEl.appendChild(div);
  });
}

renderLists();

// --- æ‰‹å…¥åŠ›è¿½åŠ  ---
document.getElementById("addProductBtn").onclick=()=>{
  const code=document.getElementById("productCodeInput").value.trim();
  const qty=Number(document.getElementById("productQtyInput").value)||1;
  if(!/^\d{7}$/.test(code)) return alert(lang==="ja"?"7æ¡ã®ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„":"Please enter 7 digits code");
  checklist.push({code,qty,memo:""});
  saveData(); renderLists();
  document.getElementById("productCodeInput").value="";
};

// --- OCR ---
document.getElementById("ocrCaptureBtn").onclick=()=>document.getElementById("ocrInput").click();
document.getElementById("ocrInput").onchange=async(e)=>{
  const file=e.target.files[0]; if(!file) return;
  const result=await Tesseract.recognize(file,"eng",{tessedit_char_whitelist:"0123456789"});
  const found=result.data.text.match(/\d{7}/g);
  if(found&&found.length>0){
    found.forEach(num=>checklist.push({code:num,qty:1,memo:""}));
    saveData(); renderLists();
    alert(`${found.length}ä»¶ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ãŸ`);
  } else alert(lang==="ja"?"7æ¡ã‚³ãƒ¼ãƒ‰ã‚’æ¤œå‡ºã§ãã¾ã›ã‚“ã§ã—ãŸ":"No 7 digits code found");
};

// --- ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ« ---
const groupModal=document.getElementById("groupModal");
document.getElementById("createGroupBtn").onclick=()=>{
  // ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸå•†å“ã ã‘è¡¨ç¤º
  const selected=checklist.map((item,i)=>({
