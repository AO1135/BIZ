<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Indent â€” ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</title>
<style>
body { font-family:'Noto Sans JP',sans-serif; margin:0; background:#fff; color:#000; }
header { display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid #ccc; }
h1 { font-size:18px; margin:0; }
main { padding:12px; }
button, input { font-size:16px; padding:6px; border:1px solid #000; border-radius:6px; box-sizing:border-box; }
button { background:#000; color:#fff; cursor:pointer; }
nav { position:fixed; bottom:0; left:0; right:0; display:flex; background:#000; }
nav button { flex:1; border:none; border-right:1px solid #fff; background:#000; color:#fff; padding:10px; }
nav button:last-child { border-right:none; }
.hidden { display:none; }
.list-item { border:1px solid #000; padding:6px; margin-bottom:6px; border-radius:6px; display:flex; flex-wrap:wrap; align-items:center; gap:6px; }
.list-item input[type="number"] { width:70px; }
.list-item input.memoInput { width:100px; }
.copyBtn { background:#fff; color:#000; border:1px solid #000; }
</style>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
</head>
<body>
<header>
<h1 id="title">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›</h1>
<button type="button" id="langBtn">æ—¥æœ¬èª / English</button>
</header>

<main>
<section id="page-password">
<input id="passwordInput" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" />
<button type="button" id="passwordSubmit">ãƒ­ã‚°ã‚¤ãƒ³</button>
<p id="passwordError" style="color:red;display:none">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™</p>
</section>

<section id="page-login" class="hidden">
<input id="userIdInput" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å…¥åŠ›" />
<button type="button" id="loginSubmit">ãƒ­ã‚°ã‚¤ãƒ³</button>
</section>

<section id="page-checklist" class="hidden">
<h2 id="checklistTitle">ãƒã‚§ãƒƒã‚¯å¾…ã¡ãƒªã‚¹ãƒˆ</h2>
<div style="display:flex;gap:8px;margin-bottom:8px;">
<input id="productCodeInput" placeholder="7æ¡ã®ã‚³ãƒ¼ãƒ‰" />
<input id="productQtyInput" type="number" min="1" value="1" />
<button type="button" id="addProductBtn">è¿½åŠ </button>
</div>
<div style="display:flex;gap:8px;margin-bottom:8px;">
<button type="button" id="ocrCaptureBtn">ğŸ“· OCRã§è¿½åŠ </button>
<input type="file" id="ocrInput" accept="image/*" capture="environment" class="hidden" />
</div>
<div id="checklist"></div>
<div style="display:flex;gap:8px;margin-top:8px;">
<button type="button" id="resetChecklistBtn">ãƒã‚§ãƒƒã‚¯å¾…ã¡ãƒªã‚¹ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ</button>
<button type="button" id="resetAllBtn">å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
</div>
</section>

<section id="page-checked" class="hidden">
<h2 id="checkedTitle">ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ãƒªã‚¹ãƒˆ</h2>
<div id="checkedList"></div>
<button type="button" id="resetCheckedBtn" style="margin-top:8px;">ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ãƒªã‚¹ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ</button>
</section>
</main>

<nav>
<button type="button" id="navChecklist">ğŸ“‹ ãƒã‚§ãƒƒã‚¯å¾…ã¡</button>
<button type="button" id="navChecked">âœ… ãƒã‚§ãƒƒã‚¯æ¸ˆã¿</button>
</nav>

<script>
document.addEventListener("DOMContentLoaded",()=>{

const PASSWORD="0509";
let currentPage="page-password";
let lang="ja";
let checklist=JSON.parse(localStorage.getItem("indent:checklist")||"[]");
let checkedList=JSON.parse(localStorage.getItem("indent:checkedList")||"[]");
let isPasswordOk=false;
let isLoginOk=false;

// --- ãƒ†ã‚­ã‚¹ãƒˆ ---
const texts={
ja:{
password:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›", login:"ãƒ­ã‚°ã‚¤ãƒ³", checklist:"ãƒã‚§ãƒƒã‚¯å¾…ã¡ãƒªã‚¹ãƒˆ", checked:"ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ãƒªã‚¹ãƒˆ",
add:"è¿½åŠ ", enterID:"IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", passFirst:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…ˆã«çªç ´ã—ã¦ãã ã•ã„",
code7:"7æ¡ã®ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", copied:"ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ", ocrAdded:"OCRã§è¿½åŠ ã—ã¾ã—ãŸ",
resetChecklist:"ãƒã‚§ãƒƒã‚¯å¾…ã¡ãƒªã‚¹ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ", resetChecked:"ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ãƒªã‚¹ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ", resetAll:"å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ"
},
en:{
password:"Enter Password", login:"Login", checklist:"Checklist", checked:"Checked Items",
add:"Add", enterID:"Please enter ID", passFirst:"Please enter password first",
code7:"Please enter 7 digits code", copied:"Copied", ocrAdded:"Added via OCR",
resetChecklist:"Reset Checklist", resetChecked:"Reset Checked", resetAll:"Reset All"
}
};

// --- ãƒšãƒ¼ã‚¸åˆ‡æ›¿ ---
function showPage(id){ 
  ["page-password","page-login","page-checklist","page-checked"].forEach(p=>document.getElementById(p).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
  currentPage=id;
  if(id!=="page-password" && id!=="page-login") document.getElementById("title").textContent=texts[lang][id.replace("page-","")];
  updateButtonTexts();
}

// --- è¨€èªåˆ‡æ›¿ ---
function updateButtonTexts(){
  document.getElementById("addProductBtn").textContent=texts[lang].add;
  document.getElementById("resetChecklistBtn").textContent=texts[lang].resetChecklist;
  document.getElementById("resetCheckedBtn").textContent=texts[lang].resetChecked;
  document.getElementById("resetAllBtn").textContent=texts[lang].resetAll;
}

document.getElementById("langBtn").addEventListener("click",()=>{
  lang=(lang==="ja"?"en":"ja");
  showPage(currentPage);
});

// --- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ ---
document.getElementById("passwordSubmit").addEventListener("click",()=>{
  const val=document.getElementById("passwordInput").value;
  if(val===PASSWORD){ isPasswordOk=true; showPage("page-login"); }
  else{ let err=document.getElementById("passwordError"); err.style.display="block"; setTimeout(()=>err.style.display="none",2000);}
});

// --- ãƒ­ã‚°ã‚¤ãƒ³ ---
document.getElementById("loginSubmit").addEventListener("click",()=>{
  if(!isPasswordOk) return alert(texts[lang].passFirst);
  const id=document.getElementById("userIdInput").value.trim();
  if(!id) return alert(texts[lang].enterID);
  localStorage.setItem("indent:user",id);
  isLoginOk=true;
  showPage("page-checklist");
});

// --- ä¿å­˜ ---
function saveData(){ localStorage.setItem("indent:checklist",JSON.stringify(checklist)); localStorage.setItem("indent:checkedList",JSON.stringify(checkedList)); }

// --- ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ã¾ã¨ã‚ ---
function getCheckedSummary(){
  const summary={};
  checkedList.forEach(item=>{
    if(summary[item.code]) summary[item.code].qty+=item.qty;
    else summary[item.code]={qty:item.qty,memo:item.memo||""};
  });
  return summary;
}

// --- ãƒªã‚¹ãƒˆæç”» ---
function renderLists(){
  const checklistEl=document.getElementById("checklist");
  const checkedListEl=document.getElementById("checkedList");
  checklistEl.innerHTML="";
  checklist.forEach((item,i)=>{
    const div=document.createElement("div");
    div.className="list-item";
    div.innerHTML=`<span>${item.code}</span>
    <input type="number" min="1" value="${item.qty}" data-i="${i}" class="qtyInput"/>
    <input class="memoInput" type="text" placeholder="ãƒ¡ãƒ¢" value="${item.memo||''}" data-i="${i}"/>
    <button type="button" class="copyBtn" data-code="${item.code}">ã‚³ãƒ”ãƒ¼</button>
    <button type="button" class="checkBtn" data-i="${i}">âœ”</button>`;
    checklistEl.appendChild(div);
  });

  // --- ã‚¤ãƒ™ãƒ³ãƒˆå§”è­² ---
  checklistEl.addEventListener("click", function(e){
    const target = e.target;
    if(target.classList.contains("checkBtn")){
      const i=target.dataset.i;
      if(checklist[i].qty>1){
        checklist[i].qty--;
        checkedList.push({code:checklist[i].code,qty:1,memo:checklist[i].memo});
      } else {
        checkedList.push(checklist[i]);
        checklist.splice(i,1);
      }
      saveData(); renderLists();
    }
    if(target.classList.contains("copyBtn")){
      navigator.clipboard.writeText(target.dataset.code);
      alert(texts[lang].copied);
    }
  });

  document.querySelectorAll(".qtyInput").forEach(inp=>{ inp.onchange=e=>{ checklist[e.target.dataset.i].qty=Number(e.target.value)||1; saveData(); }; });
  document.querySelectorAll(".memoInput").forEach(inp=>{ inp.oninput=e=>{ checklist[e.target.dataset.i].memo=e.target.value; saveData(); }; });

  // --- ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ãƒªã‚¹ãƒˆã¾ã¨ã‚æç”» ---
  checkedListEl.innerHTML="";
  const summary=getCheckedSummary();
  Object.keys(summary).forEach(code=>{
    const div=document.createElement("div");
    div.className="list-item";
    div.textContent=`${code} Ã—${summary[code].qty} ${summary[code].memo?('('+summary[code].memo+')'):""}`;
    checkedListEl.appendChild(div);
  });
}

renderLists();

// --- æ‰‹å…¥åŠ›è¿½åŠ  ---
document.getElementById("addProductBtn").addEventListener("click",()=>{
  if(!isLoginOk) return alert(texts[lang].passFirst);
  const code=document.getElementById("productCodeInput").value.trim();
  const qty=Number(document.getElementById("productQtyInput").value)||1;
  if(!/^\d{7}$/.test(code)) return alert(texts[lang].code7);
  checklist.push({code,qty,memo:""}); saveData(); renderLists(); document.getElementById("productCodeInput").value="";
});

// --- OCR ---
const ocrBtn=document.getElementById("ocrCaptureBtn");
const ocrInput=document.getElementById("ocrInput");
ocrBtn.addEventListener("click",()=>ocrInput.click());
ocrInput.addEventListener("change",async(e)=>{
  if(!isLoginOk) return alert(texts[lang].passFirst);
  const file=e.target.files[0]; if(!file) return;
  const { data:{text} } = await Tesseract.recognize(file,'eng');
  const codes=text.match(/\b\d{7}\b/g);
  if(codes) codes.forEach(code=>checklist.push({code,qty:1,memo:""}));
  saveData(); renderLists();
  alert(texts[lang].ocrAdded);
  ocrInput.value="";
});

// --- ãƒªã‚»ãƒƒãƒˆ ---
document.getElementById("resetChecklistBtn").addEventListener("click",()=>{ if(!isLoginOk) return; checklist=[]; saveData(); renderLists(); });
document.getElementById("resetCheckedBtn").addEventListener("click",()=>{ if(!isLoginOk) return; checkedList=[]; saveData(); renderLists(); });
document.getElementById("resetAllBtn").addEventListener("click",()=>{ if(!isLoginOk) return; checklist=[]; checkedList=[]; saveData(); renderLists(); });

// --- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ ---
document.getElementById("navChecklist").addEventListener("click",()=>{ if(!isLoginOk) return; showPage("page-checklist"); });
document.getElementById("navChecked").addEventListener("click",()=>{ if(!isLoginOk) return; showPage("page-checked"); });

// --- ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ»æ‰‹å…¥åŠ›ãƒã‚§ãƒƒã‚¯ ---
// ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼æŠ¼ä¸‹ã§ãƒã‚§ãƒƒã‚¯å¾…ã¡ãƒªã‚¹ãƒˆæ¤œç´¢
document.getElementById("productCodeInput").addEventListener("keypress",(e)=>{
  if(e.key==="Enter"){
    const code=e.target.value.trim();
    if(!code) return;
    const idx=checklist.findIndex(item=>item.code===code);
    if(idx<0) return alert("è©²å½“ãªã—");
    const item=checklist[idx];
    if(item.qty===1){
      checkedList.push(item);
      checklist.splice(idx,1);
    } else {
      let cnt=prompt(`æ•°é‡ã‚’å…¥åŠ› (1ã€œ${item.qty})`,1);
      cnt=Math.min(Math.max(Number(cnt)||1,1),item.qty);
      checklist[idx].qty-=cnt;
      checkedList.push({code:item.code,qty:cnt,memo:item.memo});
    }
    saveData(); renderLists(); e.target.value="";
  }
});

});
</script>
</body>
</html>
